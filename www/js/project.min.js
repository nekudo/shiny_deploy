;var app=angular.module('shinyDeploy',['ngRoute','ws','angular-jwt','shinyDeploy.config']);app.config(['$routeProvider','$locationProvider','wsProvider','shinyDeployConfig',function(e,t,n,o){t.html5Mode(!0);n.setUrl(o.wsUrl);e.when('/',{controller:'HomeController',controllerAs:'vm',templateUrl:'/js/app/home/home.html'}).when('/login',{controller:'LoginController',controllerAs:'vm',templateUrl:'/js/app/login/login.html'}).when('/servers',{controller:'ServersListController',controllerAs:'vm',templateUrl:'/js/app/servers/servers.html'}).when('/servers/add',{controller:'ServersAddController',controllerAs:'vm',templateUrl:'/js/app/servers/servers_form.html'}).when('/servers/edit/:serverId',{controller:'ServersEditController',controllerAs:'vm',templateUrl:'/js/app/servers/servers_form.html'}).when('/repositories',{controller:'RepositoriesListController',controllerAs:'vm',templateUrl:'/js/app/repositories/repositories.html'}).when('/repositories/add',{controller:'RepositoriesAddController',controllerAs:'vm',templateUrl:'/js/app/repositories/repositories_form.html'}).when('/repositories/edit/:repositoryId',{controller:'RepositoriesEditController',controllerAs:'vm',templateUrl:'/js/app/repositories/repositories_form.html'}).when('/deployments',{controller:'DeploymentsListController',controllerAs:'vm',templateUrl:'/js/app/deployments/deployments.html'}).when('/deployments/add',{controller:'DeploymentsAddController',controllerAs:'vm',templateUrl:'/js/app/deployments/deployments_form.html'}).when('/deployments/edit/:deploymentId',{controller:'DeploymentsEditController',controllerAs:'vm',templateUrl:'/js/app/deployments/deployments_form.html'}).when('/deployments/run/:deploymentId',{controller:'DeploymentsRunController',controllerAs:'vm',templateUrl:'/js/app/deployments/deployments_run.html'}).otherwise({redirectTo:'/login'})}]);app.run(['ws','authService',function(e,t){e.connect();t.init()}]);(function(){'use strict';angular.module('shinyDeploy').controller('DeploymentsAddController',e);e.$inject=['$location','deploymentsService','alertsService'];function e(e,t,o){var n=this;n.isAdd=!0;n.deployment={};n.servers={};n.repositories={};n.branches={};n.task={};n.taskFormMode='add';n.addDeployment=s;n.refreshBranches=i;n.showAddTask=l;n.showEditTask=a;n.addTask=c;n.editTask=u;n.deleteTask=d;r();function r(){t.getServers().then(function(e){n.servers=e},function(e){console.log('Error fetching servers: '+e)});t.getRepositories().then(function(e){n.repositories=e},function(e){console.log('Error fetching repositories: '+e)})};function s(){n.deployment.server_id=n.deployment.server.id;n.deployment.repository_id=n.deployment.repository.id;n.deployment.branch=n.deployment.branchObj.id;t.addDeployment(n.deployment).then(function(t){e.path('/deployments');o.queueAlert('Deployment successfully added.','success')},function(e){o.pushAlert(e,'warning')})};function i(){t.getRepositoryBranches(n.deployment.repository.id).then(function(e){n.branches=e},function(e){o.pushAlert(e,'warning')})};function l(){n.taskFormMode='add';n.task={};jQuery('#editTaskModal').modal('show')};function a(e){n.task=n.deployment.tasks[e];n.taskFormMode='edit';jQuery('#editTaskModal').modal('show')};function c(){if(!n.deployment.hasOwnProperty('tasks')){n.deployment.tasks=[]};n.deployment.tasks.push(n.task);n.task={};jQuery('#editTaskModal').modal('hide')};function u(){n.task={};jQuery('#editTaskModal').modal('hide')};function d(e){n.deployment.tasks.splice(e,1)}}})();(function(){'use strict';angular.module('shinyDeploy').controller('DeploymentsEditController',e);e.$inject=['$location','$routeParams','deploymentsService','alertsService'];function e(e,n,o,r){var t=this;t.isEdit=!0;t.servers={};t.repositories={};t.branches={};t.deployment={};t.task={};t.taskFormMode='add';t.apiUrl='';t.updateDeployment=i;t.refreshBranches=l;t.showAddTask=a;t.showEditTask=c;t.addTask=u;t.editTask=d;t.deleteTask=p;t.generateApiKey=f;s();function s(){o.getServers().then(function(e){t.servers=e},function(e){console.log('Error fetching servers: '+e)});o.getRepositories().then(function(e){t.repositories=e},function(e){console.log('Error fetching repositories: '+e)});var r=(n.deploymentId)?parseInt(n.deploymentId):0;o.getDeploymentData(r).then(function(e){t.deployment=e;t.refreshBranches()},function(t){e.path('/deployments')})};function i(){t.deployment.server_id=t.deployment.server.id;t.deployment.repository_id=t.deployment.repository.id;t.deployment.branch=t.deployment.branchObj.id;o.updateDeployment(t.deployment).then(function(e){r.pushAlert('Deployment successfully updated.','success')},function(e){r.pushAlert(e,'warning')})};function l(){o.getRepositoryBranches(t.deployment.repository.id).then(function(e){t.branches=e},function(e){r.pushAlert(e,'warning')})};function a(){t.taskFormMode='add';t.task={};jQuery('#editTaskModal').modal('show')};function c(e){t.task=t.deployment.tasks[e];t.taskFormMode='edit';jQuery('#editTaskModal').modal('show')};function u(){if(!t.deployment.hasOwnProperty('tasks')){t.deployment.tasks=[]};t.deployment.tasks.push(t.task);t.task={};jQuery('#editTaskModal').modal('hide')};function d(){t.task={};jQuery('#editTaskModal').modal('hide')};function p(e){t.deployment.tasks.splice(e,1)};function f(){o.generateApiKey(t.deployment).then(function(e){if(!e.hasOwnProperty('apiKey')){r.pushAlert('Could not generate API key.','warning');return!1};var n=location.protocol+'//'+location.hostname;n+='/api.php?ak='+e.apiKey+'&ap='+e.password;t.apiUrl=n},function(e){r.pushAlert(e,'warning')})}}})();(function(){'use strict';angular.module('shinyDeploy').controller('DeploymentsListController',e);e.$inject=['deploymentsService','alertsService'];function e(e,t){var n=this;n.deployments=null;n.getDeployments=r;n.deleteDeployment=s;o();function o(){var t=e.getDeployments();t.then(function(e){n.deployments=e},function(e){console.log('Error fetching deployments: '+e)})};function r(){return n.deployments};function s(o){e.deleteDeployment(o).then(function(e){for(var r=n.deployments.length-1;r>=0;r--){if(n.deployments[r].id===o){n.deployments.splice(r,1);break}};t.pushAlert('Deployment successfully deleted.','success')},function(e){t.pushAlert(e,'warning')})}}})();(function(){'use strict';angular.module('shinyDeploy').controller('DeploymentsRunController',e);e.$inject=['$location','$routeParams','$scope','$sce','deploymentsService','serversService','repositoriesService','ws'];function e(e,n,o,s,r,i,l,b){var t=this;t.deployment={};t.changedFiles={};t.diff='';t.remoteRevision='';t.localRevision='';t.deploymentLogs=[];t.tasksToRun={};t.triggerDeploy=d;t.triggerGetChangedFiles=p;t.triggerShowDiff=f;t.triggerSetLocalRevision=m;t.triggerSetRemoteRevision=y;t.updateChangedFiles=h;t.showDiff=v;t.setLocalRevision=D;t.setRemoteRevision=g;t.closeChangedFiles=k;t.closeDiff=R;t.showDeploymentLogs=S;t.closeDeploymentLogs=w;a();function a(){var o=(n.deploymentId)?parseInt(n.deploymentId):0;r.getDeploymentData(o).then(function(e){t.deployment=e;c();u()},function(t){e.path('/deployments')});r.addEventListener('setLocalRevision',t.setLocalRevision);r.addEventListener('setRemoteRevision',t.setRemoteRevision);r.addEventListener('updateChangedFiles',t.updateChangedFiles);r.addEventListener('showDiff',t.showDiff);t.triggerSetLocalRevision(o);t.triggerSetRemoteRevision(o)};function c(){i.getServerData(t.deployment.server_id).then(function(e){t.deployment.server=e});l.getRepositoryData(t.deployment.repository_id).then(function(e){t.deployment.repository=e})};function u(){if(t.deployment.tasks.length===0){return!0};angular.forEach(t.deployment.tasks,function(e,n){t.tasksToRun[e.id]=0;if(e.hasOwnProperty('run_by_default')&&e.run_by_default==='1'){t.tasksToRun[e.id]=1}});return!0};function d(){t.changedFiles={};t.diff='';r.triggerJob('deploy',{deploymentId:t.deployment.id,tasksToRun:t.tasksToRun})};function p(){t.changedFiles={};t.diff='';r.triggerJob('getChangedFiles',{deploymentId:t.deployment.id})};function f(e){r.triggerJob('getFileDiff',{repositoryId:t.deployment.repository_id,localRevision:t.localRevision,remoteRevision:t.remoteRevision,file:t.changedFiles[e].file})};function y(e){r.triggerJob('setRemoteRevision',{deploymentId:e})};function m(e){r.triggerJob('setLocalRevision',{deploymentId:e})};function h(e){o.$apply(function(){t.changedFiles=e.changedFiles})};function v(e){if(!e.hasOwnProperty('diff')){return};if(e.diff===null){return};o.$apply(function(){t.diff=s.trustAsHtml(Diff2Html.getPrettyHtmlFromDiff(e.diff))})};function g(e){o.$apply(function(){t.remoteRevision=(!e.revision)?'n/a':e.revision})};function D(e){o.$apply(function(){t.localRevision=(!e.revision)?'n/a':e.revision})};function k(){t.changedFiles={}};function R(){t.diff=''};function S(){r.getDeploymentLogs(t.deployment.id).then(function(e){t.deploymentLogs=e},function(e){console.log(e)})};function w(){t.deploymentLogs=[]}}})();app.service('deploymentsService',['ws','$q',function(e,t){this.getDeployments=function(){return e.sendDataRequest('getDeployments')};this.getServers=function(){return e.sendDataRequest('getServers')};this.getRepositories=function(){return e.sendDataRequest('getRepositories')};this.getRepositoryBranches=function(t){var n={repositoryId:t};return e.sendDataRequest('getRepositoryBranches',n)};this.addDeployment=function(t){var n={deploymentData:t};return e.sendDataRequest('addDeployment',n)};this.deleteDeployment=function(t){var n={deploymentId:t};return e.sendDataRequest('deleteDeployment',n)};this.updateDeployment=function(t){var n={deploymentData:t};return e.sendDataRequest('updateDeployment',n)};this.getDeploymentData=function(n){if(n===0){return!1};var o=t.defer(),r={deploymentId:n};e.sendDataRequest('getDeploymentData',r).then(function(e){if(e.hasOwnProperty('tasks')&&e.tasks===''){e.tasks=[]};e.server={};if(e.hasOwnProperty('server_id')){e.server={id:e.server_id}};e.repository={};if(e.hasOwnProperty('repository_id')){e.repository={id:e.repository_id}};e.branchObj={};if(e.hasOwnProperty('branch')){e.branchObj={id:e.branch}};o.resolve(e)});return o.promise};this.generateApiKey=function(t){var n={deploymentData:t};return e.sendDataRequest('generateApiKey',n)};this.addEventListener=function(t,n){e.addListener(t,n)};this.triggerJob=function(t,n){e.sendTriggerRequest(t,n)};this.getDeploymentLogs=function(t){var n={deploymentId:t};return e.sendDataRequest('getDeploymentLogs',n)}}]);(function(){'use strict';angular.module('shinyDeploy').controller('HomeController',e);e.$inject=['$scope'];function e(e){var t=this}})();(function(){'use strict';angular.module('shinyDeploy').controller('LoginController',e);e.$inject=['$timeout','$location','authService','alertsService'];function e(e,t,n,o){var r=this;r.password='';r.password_verify='';r.systemUserExists=!0;r.login=i;r.createSystemUser=l;s();function s(){e(function(){n.systemUserExists().then(function(e){if(e.hasOwnProperty('userExists')&&e.userExists!==!0){r.systemUserExists=!1}})},100)};function i(){n.login(r.password).then(function(e){if(e.hasOwnProperty('success')&&e.success===!0){n.setToken(e.token);t.path('/')}
else{o.pushAlert('Login failed.','error')}},function(e){o.pushAlert(e,'error')})};function l(){n.createSystemUser(r.password,r.password_verify).then(function(e){if(e.hasOwnProperty('success')&&e.success===!0){r.systemUserExists=!0;o.pushAlert('System user successfully created.','success');return!0};o.pushAlert('Error while creating system user. Check logfile for details','error');return!1},function(e){o.pushAlert(e,'error')})}}})();(function(){'use strict';angular.module('shinyDeploy').controller('RepositoriesAddController',e);e.$inject=['$location','repositoriesService','alertsService'];function e(e,t,n){var o=this;o.isAdd=!0;o.repository={};o.addRepository=r;function r(){t.addRepository(o.repository).then(function(){e.path('/repositories');n.queueAlert('Repository successfully added.','success')},function(e){n.pushAlert(e,'warning')})}}})();(function(){'use strict';angular.module('shinyDeploy').controller('RepositoriesEditController',e);e.$inject=['$location','$routeParams','repositoriesService','alertsService'];function e(e,t,n,o){var r=this;r.isEdit=!0;r.repository={};r.updateRepository=i;s();function s(){var o=(t.repositoryId)?parseInt(t.repositoryId):0;n.getRepositoryData(o).then(function(e){r.repository=e},function(){e.path('/repositories')})};function i(){n.updateRepository(r.repository).then(function(){o.pushAlert('Repository successfully updated.','success')},function(e){o.pushAlert(e,'warning')})}}})();(function(){'use strict';angular.module('shinyDeploy').controller('RepositoriesListController',e);e.$inject=['repositoriesService','alertsService'];function e(e,t){var n=this;n.repositories={};n.getRepositories=r;n.deleteRepository=s;o();function o(){e.getRepositories().then(function(e){n.repositories=e},function(e){console.log('Error fetching repositories: '+e)})};function r(){return n.repositories};function s(o){e.deleteRepository(o).then(function(){for(var e=n.repositories.length-1;e>=0;e--){if(n.repositories[e].id===o){n.repositories.splice(e,1);break}};t.pushAlert('Repository successfully deleted.','success')},function(e){t.pushAlert(e,'warning')})}}})();app.service('repositoriesService',['ws',function(e){this.getRepositories=function(){return e.sendDataRequest('getRepositories')};this.addRepository=function(t){var n={repositoryData:t};return e.sendDataRequest('addRepository',n)};this.deleteRepository=function(t){var n={repositoryId:t};return e.sendDataRequest('deleteRepository',n)};this.updateRepository=function(t){var n={repositoryData:t};return e.sendDataRequest('updateRepository',n)};this.getRepositoryData=function(t){if(t===0){return!1};var n={repositoryId:t};return e.sendDataRequest('getRepositoryData',n)}}]);(function(){'use strict';angular.module('shinyDeploy').controller('ServersAddController',e);e.$inject=['$location','serversService','alertsService'];function e(e,t,n){var o=this;o.isAdd=!0;o.server={};o.addServer=r;function r(){t.addServer(o.server).then(function(){e.path('/servers');n.queueAlert('Server successfully added.','success')},function(e){n.pushAlert(e,'warning')})}}})();(function(){'use strict';angular.module('shinyDeploy').controller('ServersEditController',e);e.$inject=['$location','$routeParams','serversService','alertsService'];function e(e,t,n,o){var r=this;r.isEdit=!0;r.server={};r.updateServer=i;s();function s(){var o=(t.serverId)?parseInt(t.serverId):0;n.getServerData(o).then(function(e){if(e.hasOwnProperty('port')){e.port=parseInt(e.port)};r.server=e},function(){e.path('/servers')})};function i(){n.updateServer(r.server).then(function(){o.pushAlert('Server successfully updated.','success')},function(e){o.pushAlert(e,'warning')})}}})();(function(){'use strict';angular.module('shinyDeploy').controller('ServersListController',e);e.$inject=['serversService','alertsService'];function e(e,t){var n=this;n.servers={};n.getServers=r;n.deleteServer=s;o();function o(){e.getServers().then(function(e){n.servers=e},function(e){console.log('Error fetching servers: '+e)})};function r(){return n.servers};function s(o){e.deleteServer(o).then(function(){for(var e=n.servers.length-1;e>=0;e--){if(n.servers[e].id===o){n.servers.splice(e,1);break}};t.pushAlert('Server successfully deleted.','success')},function(e){t.pushAlert(e,'warning')})}}})();app.service('serversService',['ws',function(e){this.getServers=function(){return e.sendDataRequest('getServers')};this.addServer=function(t){var n={serverData:t};return e.sendDataRequest('addServer',n)};this.deleteServer=function(t){var n={serverId:t};return e.sendDataRequest('deleteServer',n)};this.updateServer=function(t){var n={serverData:t};return e.sendDataRequest('updateServer',n)};this.getServerData=function(t){if(t===0){return!1};var n={serverId:t};return e.sendDataRequest('getServerData',n)}}]);(function(){'use strict';angular.module('shinyDeploy').controller('AlertsController',e);e.$inject=['$scope','alertsService'];function e(e,t){var n=this;n.alerts=[];n.addAlert=r;n.removeAlert=s;o();function o(){var r;r=e.$on('alertMessage',function(e,t,o){n.addAlert(t,o)});e.$on('$destroy',r);var o=t.getQueuedAlert();if(o!==''){n.addAlert(o.message,o.type)}};function r(e,t){n.alerts.push({msg:e,type:t})};function s(e){n.alerts.splice(e,1)}}})();(function(){'use strict';angular.module('shinyDeploy').controller('LogController',e);e.$inject=['$scope','ws'];function e(e,t){var n=this;n.logs=[];t.addListener('log',function(e){o(e)});function o(e){var n=e.text.split('\n');for(var t=0;t<n.length;t++){r({message:n[t],styleclass:(e.hasOwnProperty('type'))?'log-'+e.type:'log-default',time:(e.hasOwnProperty('time'))?e.time:s(),source:(e.hasOwnProperty('source'))?e.source:''})};$('.nano').nanoScroller().nanoScroller({scroll:'bottom'})};function r(t){e.$apply(function(){n.logs.push(t)})};function s(){var e=new Date();return((e.getHours()<10)?'0':'')+e.getHours()+':'+((e.getMinutes()<10)?'0':'')+e.getMinutes()+':'+((e.getSeconds()<10)?'0':'')+e.getSeconds()}}})();(function(){'use strict';angular.module('shinyDeploy').controller('MenuController',e);e.$inject=['$location'];function e(e){var t=this;t.getClass=n;function n(t){return(e.path().substr(0,t.length)==t)}}})();(function(){'use strict';angular.module('shinyDeploy').controller('NotificationsController',e);e.$inject=['$scope','$timeout','ws'];function e(e,t,n){var o=this;o.notifications=[];o.notificationsCount=0;r();function r(){n.addListener('notification',function(e){var t=e.text,n=(typeof e.type!=='undefined')?e.type:'default';s(t,n)})};function s(n,r){e.$apply(function(){o.notifications.push({msg:n,type:r,id:'notification-'+o.notificationsCount});t(i,5000);o.notificationsCount++})};function i(){o.notifications.splice(0,1)}}})();(function(){'use strict';angular.module('shinyDeploy').directive('changedFileStatus',e);function e(){var e={restrict:'A',template:'<span class="label {{ itemTypeClass }}">{{ itemTypeName }}</span>',scope:{itemType:'=type'},replace:!0,link:t};return e;function t(e,t,n){switch(e.itemType){case'A':e.itemTypeClass='label-success';e.itemTypeName='Added';break;case'C':e.itemTypeClass='label-info';e.itemTypeName='Copied';break;case'D':e.itemTypeClass='label-danger';e.itemTypeName='Deleted';break;case'M':e.itemTypeClass='label-primary';e.itemTypeName='Modified';break;case'R':e.itemTypeClass='label-info';e.itemTypeName='Renamed';break}}}})();app.directive('ngReallyClick',[function(){return{restrict:'A',link:function(e,t,n){t.bind('click',function(){var t=n.ngReallyMessage;if(t&&confirm(t)){e.$apply(n.ngReallyClick)}})}}}]);(function(){'use strict';angular.module('shinyDeploy').directive('wscStatus',t);function t(){var t={restrict:'A',template:'<span class="fa fa-plug {{vm.statusClass}}"></span>',scope:{},replace:!0,link:n,controller:e,controllerAs:'vm',bindToController:!0};return t;function n(e,t,n){}};e.$inject=['$scope','ws'];function e(e,t){var n=this;n.statusClass='text-red';n.updateStatusClass=r;var o;o=e.$on('wsStatusChange',function(t,o){e.$apply(function(){n.updateStatusClass(o)})});e.$on('$destroy',o);function r(e){switch(e){case'connected':n.statusClass='text-green';break;case'disconnected':n.statusClass='text-red';break}}}})();angular.module('ws',[]).provider('ws',wsProvider);function wsProvider(){var e=this;this.config={url:'ws://127.0.0.1:8090'};this.$get=['$rootScope','$q',t];this.setUrl=function(e){this.config.url=e;return this};function t(t,o){var n={};var r=0;n.listeners=[];n.callbacks=[];n.clientId='';n.token='';n.status='disconnected';n.connect=s;n.onClose=i;n.onMessage=l;n.sendTriggerRequest=a;n.sendDataRequest=c;n.addListener=u;n.getCallbackId=d;n.getUuid=p;n.setStatus=m;n.getStatus=h;n.setToken=v;function s(t){t=t||{};if(t.url)e.config.url=t.url;n.clientId=n.getUuid();n.conn=new ab.Session(e.config.url,function(){console.log('Websocket connection established.');n.setStatus('connected');n.conn.subscribe(n.clientId,function(e,t){n.onMessage(e,t)})},function(e){n.onClose(e)})};function i(e){n.setStatus('disconnected');switch(e){case ab.CONNECTION_CLOSED:console.log('Connection was closed properly.');break;case ab.CONNECTION_UNREACHABLE:console.log('Websocket connection could not be established.');break;case ab.CONNECTION_UNSUPPORTED:console.log('Browser does not support WebSocket.');break;case ab.CONNECTION_LOST:default:console.log('Websocket connection lost.');break}};function l(e,t){try{if(t.hasOwnProperty('eventName')){y(e,t)}
else if(t.hasOwnProperty('callbackId')){f(e,t)}}catch(n){console.log(n)};return!1};function a(e,t){var o={clientId:n.clientId,token:n.token,actionPayload:t};n.conn.call(e,o)};function c(e,t){var s={clientId:n.clientId,token:n.token,callbackId:n.getCallbackId(),actionPayload:t};var r=o.defer();n.callbacks[s.callbackId]={time:new Date(),cb:r};n.conn.call(e,s);return r.promise};function u(e,t){n.listeners[e]=t;return!0};function d(){r+=1;if(r>10000){r=0};return r};function p(){var e=sessionStorage.getItem('uuid');if(e!==null){return e};e='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=='x'?t:(t&0x3|0x8);return n.toString(16)});sessionStorage.setItem('uuid',e);return e};function f(e,o){if(!o.hasOwnProperty('type')){console.log('Received invalid data message: Type is missing.')};var r=o.callbackId,i=o.payload,s=o.type;if(n.callbacks.hasOwnProperty(r)){if(s==='success'){t.$apply(n.callbacks[r].cb.resolve(i))}
else if(s==='error'){t.$apply(n.callbacks[r].cb.reject(o.reason))};delete n.callbacks[r]}
else{console.log('Could not resolve callback.')}};function y(e,t){var o=t.eventName,r=t.eventPayload;if(n.listeners.hasOwnProperty(o)){return n.listeners[o](r)}
else{console.log('Could not find any listener for event: '+o)}};function m(e){n.status=e;t.$broadcast('wsStatusChange',n.status)};function h(){return n.status};function v(e){n.token=e};return n}};app.service('alertsService',['$rootScope',function(e){this.queue=[];this.pushAlert=function(t,n){n=typeof n!=='undefined'?n:'info';e.$broadcast('alertMessage',t,n)};this.queueAlert=function(e,t){t=typeof t!=='undefined'?t:'info';var n={type:t,message:e};this.queue.push(n)};this.getQueuedAlert=function(){return this.queue.shift()||''}}]);(function(){'use strict';angular.module('shinyDeploy').factory('authService',e);e.$inject=['ws','$rootScope','$location','jwtHelper'];function e(e,t,n,o){var s={init:i,login:u,setToken:d,systemUserExists:p,createSystemUser:f};return s;function i(){var n=r();if(n!==null){e.setToken(n)};t.$on('$locationChangeStart',function(e,t,n){l()});e.addListener('unauthorized',function(e){a(e)})};function l(){if(!c()){n.path('/login');return!1};return!0};function a(e){sessionStorage.removeItem('token');n.path('/login');return!1};function c(){var t=r();if(t===null){return!1};try{if(o.isTokenExpired(t)){return!1};var n=sessionStorage.getItem('uuid'),e=o.decodeToken(t);if(!e.hasOwnProperty('iss')||e.iss!=='ShinyDeploy'){return!1};if(!e.hasOwnProperty('jti')||e.jti!==n){return!1}}catch(s){return!1};return!0};function u(t){var n={password:t};return e.sendDataRequest('login',n)};function d(t){sessionStorage.setItem('token',t);e.setToken(t)};function r(){return sessionStorage.getItem('token')};function p(){var t={username:'system'};return e.sendDataRequest('userExists',t)};function f(t,n){var o={username:'system',password:t,password_verify:n};return e.sendDataRequest('createUser',o)}}})();